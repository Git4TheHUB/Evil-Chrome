<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Three.js OBJ Player + GLTF Map</title>
<style>
  body { margin:0; overflow:hidden; font-family:sans-serif; }
  #chat { position:absolute; bottom:10px; left:10px; width:300px; background:rgba(0,0,0,0.4); color:white; padding:8px; border-radius:6px; font-size:14px; }
  #messages { max-height:150px; overflow-y:auto; margin-bottom:6px; }
  #chat input { width:100%; box-sizing:border-box; padding:4px; border:none; outline:none; }
</style>
</head>
<body>

<div id="chat">
  <div id="messages"></div>
  <input id="chatInput" placeholder="Press Enter to chat" />
</div>

<script type="module">
import * as THREE from "https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.module.js";
import { OrbitControls } from "https://cdn.jsdelivr.net/npm/three@0.160.0/examples/jsm/controls/OrbitControls.js";
import { GLTFLoader } from "https://cdn.jsdelivr.net/npm/three@0.160.0/examples/jsm/loaders/GLTFLoader.js";
import { OBJLoader } from "https://cdn.jsdelivr.net/npm/three@0.160.0/examples/jsm/loaders/OBJLoader.js";

//////////////////////////
// SCENE & CAMERA
//////////////////////////
const scene = new THREE.Scene();
scene.background = new THREE.Color(0x87ceeb);

const camera = new THREE.PerspectiveCamera(70, innerWidth/innerHeight, 0.1, 1000);
camera.position.set(0,5,10);

const renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(innerWidth, innerHeight);
document.body.appendChild(renderer.domElement);

scene.add(new THREE.AmbientLight(0xffffff,0.5));
const sun = new THREE.DirectionalLight(0xffffff,1);
sun.position.set(10,20,10);
scene.add(sun);

//////////////////////////
// LOAD MAP (GLTF)
//////////////////////////
const gltfLoader = new GLTFLoader();
let map;
gltfLoader.load('./models/map.gltf', (gltf)=>{
    map = gltf.scene;
    scene.add(map);
});

//////////////////////////
// LOAD PLAYER (OBJ)
//////////////////////////
const objLoader = new OBJLoader();
let player = new THREE.Group();
let playerScale = 1; // Change this to resize player

objLoader.load('Character Roblox.obj', (obj)=>{
    player = obj;
    player.scale.set(playerScale, playerScale, playerScale);
    scene.add(player);
    player.position.set(0,0,5);
});

//////////////////////////
// INPUT
//////////////////////////
const keys = {};
window.addEventListener('keydown', e=> keys[e.key.toLowerCase()] = true);
window.addEventListener('keyup', e=> keys[e.key.toLowerCase()] = false);

//////////////////////////
// PHYSICS
//////////////////////////
const velocity = new THREE.Vector3();
const gravity = -0.035;
const speed = 0.12;
const jumpPower = 0.75;
let onGround = false;
let targetRot = 0;

//////////////////////////
// CAMERA CONTROL
//////////////////////////
let yaw = 0, pitch = 0;
window.addEventListener('click', ()=>document.body.requestPointerLock());
window.addEventListener('mousemove', e=>{
  if(document.pointerLockElement !== document.body) return;
  yaw -= e.movementX * 0.002;
  pitch -= e.movementY * 0.002;
  pitch = Math.max(-0.4, Math.min(0.4, pitch));
});

//////////////////////////
// CHAT
//////////////////////////
const messages = document.getElementById('messages');
const chatInput = document.getElementById('chatInput');

chatInput.addEventListener('keydown', e=>{
  if(e.key==='Enter' && chatInput.value.trim()){
    const msg = document.createElement('div');
    msg.textContent = "You: " + chatInput.value;
    messages.appendChild(msg);
    messages.scrollTop = messages.scrollHeight;
    chatInput.value = '';
  }
});

//////////////////////////
// UPDATE LOOP
//////////////////////////
function updatePlayer(){
    if(!player) return;

    let moving = false;
    let dir = new THREE.Vector3();

    if(keys.w || keys.arrowup){ dir.z -= 1; moving=true; }
    if(keys.s || keys.arrowdown){ dir.z +=1; moving=true; }
    if(keys.a || keys.arrowleft){ dir.x -=1; moving=true; }
    if(keys.d || keys.arrowright){ dir.x +=1; moving=true; }

    if(moving){
        dir.normalize();
        targetRot = Math.atan2(dir.x, dir.z);
        player.position.x += Math.sin(targetRot)*speed;
        player.position.z += Math.cos(targetRot)*speed;
    }

    player.rotation.y += (targetRot - player.rotation.y)*0.15;

    // Jump
    if(keys[" "] && onGround){
        velocity.y = jumpPower;
        onGround=false;
    }

    velocity.y += gravity;
    player.position.y += velocity.y;
    if(player.position.y <=0){
        player.position.y = 0;
        velocity.y=0;
        onGround=true;
    }

    // Camera follow
    const camOffset = new THREE.Vector3(Math.sin(yaw)*10, 6+pitch*5, Math.cos(yaw)*10);
    camera.position.copy(player.position).add(camOffset);
    camera.lookAt(player.position.x, player.position.y+2, player.position.z);
}

//////////////////////////
// RENDER LOOP
//////////////////////////
function animate(){
    requestAnimationFrame(animate);
    updatePlayer();
    renderer.render(scene, camera);
}
animate();

//////////////////////////
// RESIZE
//////////////////////////
window.addEventListener('resize', ()=>{
  camera.aspect = innerWidth/innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(innerWidth, innerHeight);
});

</script>
</body>
</html>

</script>

</body>
</html>
